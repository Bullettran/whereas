<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character with Directional Movement</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div class="controls">
    <button onclick="attack()">Attack</button>
    <button onclick="stop()">Stop</button>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Устанавливаем размер канваса
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Загружаем изображения
    const idleSprite = new Image();
    idleSprite.src = "Attack3_Body_090.png"; // Спрайт для стояния и атаки

    const attackUpSprite = new Image();
    attackUpSprite.src = "sprites-320/Attack1/Attack1_Body_000.png"; // Атака вверх (подставь свой путь)
    const attackDownSprite = new Image();
    attackDownSprite.src = "sprites-320/Attack1/Attack1_Body_180.png"; // Атака вниз
    const attackLeftSprite = new Image();
    attackLeftSprite.src = "sprites-320/Attack1/Attack1_Body_270.png"; // Атака влево
    const attackRightSprite = new Image();
    attackRightSprite.src = "sprites-320/Attack1/Attack1_Body_090.png"; // Атака вправо




    const walkUpSprite = new Image();
    walkUpSprite.src = "sprites-320/Walk/Walk_Body_000.png"; // Спрайт для движения вверх

    const walkDownSprite = new Image();
    walkDownSprite.src = "sprites-320/Walk/Walk_Body_180.png"; // Спрайт для движения вниз

    const walkLeftSprite = new Image();
    walkLeftSprite.src = "sprites-320/Walk/Walk_Body_270.png"; // Спрайт для движения влево

    const walkRightSprite = new Image();
    walkRightSprite.src = "sprites-320/Walk/Walk_Body_090.png"; // Спрайт для движения вправо



    const enemyIdleSprite = new Image();
    enemyIdleSprite.src = "sprites-320/Idle/Idle_Shadow_000.png"; // Укажи путь к своему спрайту врага


    // Параметры врага
    const enemyWidth = 320; // Размер спрайта врага
    const enemyHeight = 320;
    let enemyX = 500; // Начальная позиция врага
    let enemyY = canvas.height - enemyHeight - 50;
    const enemySpeed = 1; // Скорость врага
    let enemyState = "idle"; // Состояние врага: idle, walk, attack
    let enemyFrameIndex = 0;
    let enemyFrameCount = 3; // Количество кадров для анимации врага
    let enemyTickCount = 0;
    let enemyHealth = 100; // Здоровье врага
    let playerHealth = 100; // Здоровье игрока



    const mapWidth = 3000; // Размер локации
    const mapHeight = 2000;
    let cameraX = -(mapWidth / 2 - canvas.width / 2); // Начальная позиция камеры
    let cameraY = -(mapHeight / 2 - canvas.height / 2);

    // Параметры персонажа
    const spriteWidth = 320;
    const spriteHeight = 320;
    let positionX = 50;
    let positionY = canvas.height - spriteHeight - 50; // Персонаж на "земле"
    const speed = 5;

    // Анимация
    let frameIndex = 0;
    let frameCount = 3; // По умолчанию для стояния
    let animationSpeed = 40; // Скорость смены кадров
    let tickCount = 0;
    let state = "idle"; // Состояние: idle, walk, attack
    let direction = "right"; // Направление: up, down, left, right

    // Управление
    const keys = {
        w: false,
        a: false,
        s: false,
        d: false,
        space: false
    };

    // Обработчики клавиш
    document.addEventListener("keydown", (e) => {
        if (e.key === "w" || e.key === "W") keys.w = true;
        if (e.key === "a" || e.key === "A") keys.a = true;
        if (e.key === "s" || e.key === "S") keys.s = true;
        if (e.key === "d" || e.key === "D") keys.d = true;
        if (e.key === " ") keys.space = true;
    });

    document.addEventListener("keyup", (e) => {
        if (e.key === "w" || e.key === "W") keys.w = false;
        if (e.key === "a" || e.key === "A") keys.a = false;
        if (e.key === "s" || e.key === "S") keys.s = false;
        if (e.key === "d" || e.key === "D") keys.d = false;
        if (e.key === " ") keys.space = false;
    });

    function updatePosition() {
        let isMoving = false;

        // Движение игрока (оставляем как есть)
        if (keys.w) {
            positionY = Math.max(0, positionY - speed);
            direction = "up";
            isMoving = true;
        }
        if (keys.s) {
            positionY = Math.min(canvas.height - spriteHeight, positionY + speed);
            direction = "down";
            isMoving = true;
        }
        if (keys.a) {
            positionX = Math.max(0, positionX - speed);
            direction = "left";
            isMoving = true;
        }
        if (keys.d) {
            positionX = Math.min(canvas.width - spriteWidth, positionX + speed);
            direction = "right";
            isMoving = true;
        }

        // Обновляем состояние игрока
        if (keys.space) {
            state = "attack";
        } else if (isMoving) {
            state = "walk";
        } else {
            state = "idle";
        }

        // Движение врага к игроку
        const dx = positionX - enemyX;
        const dy = positionY - enemyY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance > 50) { // Если враг далеко, он идет к игроку
            enemyX += (dx / distance) * enemySpeed;
            enemyY += (dy / distance) * enemySpeed;
            enemyState = "walk";
        } else { // Если близко, враг атакует
            enemyState = "attack";
            if (state === "attack") { // Если игрок тоже атакует
                enemyHealth -= 5; // Урон врагу
            }
            if (enemyState === "attack") {
                playerHealth -= 2; // Урон игроку от врага
            }
        }

        // Проверка на смерть
        if (enemyHealth <= 0) {
            enemyX = -1000; // Убираем врага за пределы экрана
            enemyState = "idle";
        }
        if (playerHealth <= 0) {
            state = "idle"; // Останавливаем игрока (можно добавить "game over")
        }
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Рисуем локацию
        ctx.fillStyle = "#90EE90";
        ctx.fillRect(0, 0, mapWidth, mapHeight);

        // Обновляем позицию
        updatePosition();

        // Анимация игрока
        tickCount++;
        if (tickCount > animationSpeed) {
            frameIndex = (frameIndex + 1) % frameCount;
            tickCount = 0;
        }

        // Определяем кадры игрока
        let srcX, srcY, currentSprite;
        if (state === "idle") {
            currentSprite = idleSprite;
            frameCount = 3;
            srcX = (frameIndex + 1) * spriteWidth;
            srcY = 0;
        } else if (state === "walk") {
            frameCount = 16;
            const row = Math.floor(frameIndex / 4);
            const col = frameIndex % 4;
            srcX = col * spriteWidth;
            srcY = row * spriteHeight;
            if (direction === "up") currentSprite = walkUpSprite;
            else if (direction === "down") currentSprite = walkDownSprite;
            else if (direction === "left") currentSprite = walkLeftSprite;
            else if (direction === "right") currentSprite = walkRightSprite;
        } else if (state === "attack") {
            frameCount = 24; // Предполагаем, что у спрайтов атаки 24 кадра
            const row = Math.floor(frameIndex / 6);
            const col = frameIndex % 6;
            srcX = col * spriteWidth;
            srcY = row * spriteHeight;

            // Выбираем спрайт атаки в зависимости от направления
            if (direction === "up") currentSprite = attackUpSprite;
            else if (direction === "down") currentSprite = attackDownSprite;
            else if (direction === "left") currentSprite = attackLeftSprite;
            else if (direction === "right") currentSprite = attackRightSprite;
        }

        // Рисуем игрока
        ctx.drawImage(
            currentSprite,
            srcX, srcY,
            spriteWidth, spriteHeight,
            positionX, positionY,
            spriteWidth, spriteHeight
        );

        // Анимация врага
        enemyTickCount++;
        if (enemyTickCount > animationSpeed) {
            enemyFrameIndex = (enemyFrameIndex + 1) % enemyFrameCount;
            enemyTickCount = 0;
        }

        let enemySrcX = enemyFrameIndex * enemyWidth;
        let enemySrcY = 0; // Предполагаем, что у врага одна строка кадров
        if (enemyState === "attack") {
            enemyFrameCount = 3; // Подстрой под свой спрайт
            enemySrcX = enemyFrameIndex * enemyWidth;
        }

        // Рисуем врага
        ctx.drawImage(
            enemyIdleSprite,
            enemySrcX, enemySrcY,
            enemyWidth, enemyHeight,
            enemyX, enemyY,
            enemyWidth, enemyHeight
        );

        // Отображаем здоровье
        ctx.fillStyle = "red";
        ctx.fillRect(10, 10, playerHealth * 2, 20); // Полоса здоровья игрока
        ctx.fillRect(canvas.width - 210, 10, enemyHealth * 2, 20); // Полоса здоровья врага
        ctx.fillStyle = "black";
        ctx.font = "16px Arial";
        ctx.fillText("Player HP: " + playerHealth, 10, 40);
        ctx.fillText("Enemy HP: " + enemyHealth, canvas.width - 210, 40);

        requestAnimationFrame(animate);
    }

    // Кнопки управления
    function attack() {
        state = "attack";
    }

    function stop() {
        state = "idle";
    }

    // Ждем загрузки изображений перед стартом
    Promise.all([
        new Promise((resolve) => (idleSprite.onload = resolve)),
        new Promise((resolve) => (walkUpSprite.onload = resolve)),
        new Promise((resolve) => (walkDownSprite.onload = resolve)),
        new Promise((resolve) => (walkLeftSprite.onload = resolve)),
        new Promise((resolve) => (walkRightSprite.onload = resolve)),
        new Promise((resolve) => (attackUpSprite.onload = resolve)),
        new Promise((resolve) => (attackDownSprite.onload = resolve)),
        new Promise((resolve) => (attackLeftSprite.onload = resolve)),
        new Promise((resolve) => (attackRightSprite.onload = resolve)),
        new Promise((resolve) => (enemyIdleSprite.onload = resolve)),
    ]).then(() => {
        animate();
    });
</script>
</body>
</html>